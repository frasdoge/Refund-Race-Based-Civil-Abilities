Version 1
SubGoalCombiner SGC_AND
INITSECTION

KBSECTION

// Base events for refund
IF
GameStarted(_Region, _)
AND
IsGameLevel(_Region, 1)
AND
DB_IsPlayer(_Char)
AND
NOT DB_RRBC_HasRefunded(_Char)
THEN
SetStoryEvent(_Char, "RRBC_Refund");

IF
CharacterJoinedParty(_Char)
AND
DB_IsPlayer(_Char)
AND
NOT DB_RRBC_HasRefunded(_Char)
THEN
SetStoryEvent(_Char, "RRBC_Refund");

IF
CharacterCreationFinished(_Char)
AND
DB_IsPlayer(_Char)
AND
NOT DB_RRBC_HasRefunded(_Char)
THEN
SetStoryEvent(_Char, "RRBC_Refund");

// Base events for removal
IF
GameStarted(_Region, _)
AND
IsGameLevel(_Region, 1)
AND
DB_IsPlayer(_Char)
AND
DB_RRBC_HasRefunded(_Char)
THEN
SetStoryEvent(_Char, "RRBC_Remove");

IF
CharacterJoinedParty(_Char)
AND
DB_IsPlayer(_Char)
AND
DB_RRBC_HasRefunded(_Char)
THEN
SetStoryEvent(_Char, "RRBC_Remove");

IF
CharacterCreationFinished(_Char)
AND
DB_IsPlayer(_Char)
AND
DB_RRBC_HasRefunded(_Char)
THEN
SetStoryEvent(_Char, "RRBC_Remove");

IF
ObjectTransformed((CHARACTERGUID)_Char, _)
AND
DB_IsPlayer(_Char)
AND
DB_RRBC_HasRefunded(_Char)
THEN
SetStoryEvent(_Char, "RRBC_Remove");

// Refund
// Lizard
IF
StoryEvent((CHARACTERGUID)_Char, "RRBC_Refund")
AND
CharacterHasTalent(_Char, "Lizard_Persuasion", 1)
THEN
CharacterRemoveTalent(_Char, "Lizard_Persuasion");
CharacterAddCivilAbilityPoint(_Char, 1);
DB_RRBC_HasRefunded(_Char);

// Human
IF
StoryEvent((CHARACTERGUID)_Char, "RRBC_Refund")
AND
CharacterHasTalent(_Char, "Human_Civil", 1)
THEN
CharacterRemoveTalent(_Char, "Human_Civil");
CharacterAddCivilAbilityPoint(_Char, 1);
DB_RRBC_HasRefunded(_Char);

// Dwarf
IF
StoryEvent((CHARACTERGUID)_Char, "RRBC_Refund")
AND
CharacterHasTalent(_Char, "Dwarf_Sneaking", 1)
THEN
CharacterRemoveTalent(_Char, "Dwarf_Sneaking");
CharacterAddCivilAbilityPoint(_Char, 1);
DB_RRBC_HasRefunded(_Char);

// Elf
IF
StoryEvent((CHARACTERGUID)_Char, "RRBC_Refund")
AND
CharacterHasTalent(_Char, "Elf_Lore", 1)
THEN
CharacterRemoveTalent(_Char, "Elf_Lore");
CharacterAddCivilAbilityPoint(_Char, 1);
DB_RRBC_HasRefunded(_Char);

// Undead
IF
StoryEvent((CHARACTERGUID)_Char, "RRBC_Refund")
AND
IsTagged(_Char, "UNDEAD", 1)
THEN
CharacterAddCivilAbilityPoint(_Char, 1);
DB_RRBC_HasRefunded(_Char);

// Remove
// Lizard
IF
StoryEvent((CHARACTERGUID)_Char, "RRBC_Remove")
AND
CharacterHasTalent(_Char, "Lizard_Persuasion", 1)
THEN
CharacterRemoveTalent(_Char, "Lizard_Persuasion");

// Human
IF
StoryEvent((CHARACTERGUID)_Char, "RRBC_Remove")
AND
CharacterHasTalent(_Char, "Human_Civil", 1)
THEN
CharacterRemoveTalent(_Char, "Human_Civil");

// Dwarf
IF
StoryEvent((CHARACTERGUID)_Char, "RRBC_Remove")
AND
CharacterHasTalent(_Char, "Dwarf_Sneaking", 1)
THEN
CharacterRemoveTalent(_Char, "Dwarf_Sneaking");

// Elf
IF
StoryEvent((CHARACTERGUID)_Char, "RRBC_Remove")
AND
CharacterHasTalent(_Char, "Elf_Lore", 1)
THEN
CharacterRemoveTalent(_Char, "Elf_Lore");

EXITSECTION

ENDEXITSECTION
ParentTargetEdge "__Start"
